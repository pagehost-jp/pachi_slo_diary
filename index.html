<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="theme-color" content="#e94560">
  <!-- ========== PWA設定（開発中は無効化） ========== -->
  <!-- 本番前に有効化する場合: 以下のコメントアウトを解除してください -->
  <!--
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Maxima">
  -->
  <!-- 開発中: ブラウザモードで動作させる -->
  <meta name="apple-mobile-web-app-capable" content="no">
  <title>Maxima</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=7">
  <!-- 開発中: manifest.jsonを無効化（キャッシュを防ぐ） -->
  <!-- 本番前に有効化する場合: 以下の行のコメントアウトを解除してください -->
  <!-- <link rel="manifest" href="manifest.json"> -->
  <!-- <link rel="apple-touch-icon" href="icon-192.png"> -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
  <div class="container">
    <header class="header">
      <button class="btn btn-back-header" id="btn-back-header" style="display: none;">← 一覧</button>
      <h1 id="logo-title" style="cursor: pointer;">Maxima</h1>
      <div class="header-right">
        <button class="btn-edit" id="btn-edit" style="display: none;">編集</button>
        <button class="btn-user" id="btn-user">
          <span class="user-icon">👤</span>
          <span class="user-name" id="user-name">ログイン</span>
        </button>
        <button class="btn-settings" id="btn-settings">設定</button>
      </div>
    </header>

    <!-- 設定モーダル -->
    <div class="modal" id="settings-modal" style="display: none;">
      <div class="modal-content">
        <h3>設定</h3>
        <div class="form-group">
          <label class="form-label">Gemini APIキー</label>
          <div class="input-with-toggle">
            <input type="password" id="api-key-input" class="input-text" placeholder="AIza...">
            <button type="button" class="btn-toggle-visibility" id="btn-toggle-key">表示</button>
          </div>
          <p class="hint">Google AI Studioで無料取得: <a href="https://aistudio.google.com/app/apikey" target="_blank">こちら</a> | <a href="help.html" target="_blank">取得方法を見る</a></p>
        </div>

        <div class="form-group">
          <label class="form-label">クラウド同期</label>
          <div class="cloud-sync-status" id="cloud-sync-status">
            <span class="sync-icon">☁️</span>
            <span class="sync-text" id="sync-text">未ログイン</span>
          </div>
          <button class="btn btn-google" id="btn-google-login">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" class="google-icon">
            Googleでログイン
          </button>
          <div class="sync-buttons" id="sync-buttons" style="display: none;">
            <button class="btn btn-primary" id="btn-manual-sync">🔄 今すぐ同期</button>
            <button class="btn btn-secondary" id="btn-logout">ログアウト</button>
          </div>
          <div class="storage-usage" id="storage-usage" style="display: none;">
            <label class="form-label">データ保存容量</label>
            <div class="storage-usage-display" id="storage-usage-display">📦 0 MB 使用中 / 1000 MB (0%)</div>
            <div class="storage-bar">
              <div class="storage-bar-fill" id="storage-bar-fill" style="width: 0%"></div>
            </div>
            <div class="storage-warning" id="storage-warning" style="display: none;">
              ⚠️ 容量が800MBを超えています。古いデータの削除を検討してください。
            </div>
          </div>
          <p class="hint">ログインするとリアルタイムでクラウドに同期されます</p>
        </div>

        <div class="modal-buttons">
          <button class="btn btn-secondary" id="btn-close-settings">閉じる</button>
          <button class="btn btn-primary" id="btn-save-settings">APIキー保存</button>
        </div>
      </div>
    </div>

    <!-- ========== 月別一覧画面 ========== -->
    <section id="monthly-view" class="section">
      <!-- 固定ヘッダー部分 -->
      <div class="monthly-header" id="monthly-header">
      <div class="page-title-row">
        <!-- 年度選択バー -->
        <div class="year-selector">
          <button class="btn btn-year-nav" id="btn-prev-year">&lt;</button>
          <span class="current-year" id="current-year">2025年度</span>
          <button class="btn btn-year-nav" id="btn-next-year">&gt;</button>
        </div>
        <button class="btn btn-primary btn-add-top" id="btn-add-entry">+ 収支を入力</button>
      </div>

      <!-- 月選択ボタン -->
      <div class="month-buttons" id="month-buttons">
        <button class="month-btn" data-month="1">1月</button>
        <button class="month-btn" data-month="2">2月</button>
        <button class="month-btn" data-month="3">3月</button>
        <button class="month-btn" data-month="4">4月</button>
        <button class="month-btn" data-month="5">5月</button>
        <button class="month-btn" data-month="6">6月</button>
        <button class="month-btn" data-month="7">7月</button>
        <button class="month-btn" data-month="8">8月</button>
        <button class="month-btn" data-month="9">9月</button>
        <button class="month-btn" data-month="10">10月</button>
        <button class="month-btn active" data-month="11">11月</button>
        <button class="month-btn" data-month="12">12月</button>
        <button class="month-btn all-btn" data-month="all">全て</button>
      </div>

      <!-- 月間サマリー -->
      <div class="monthly-summary">
        <div class="summary-item">
          <span class="summary-label" id="summary-month-label">稼働日数</span>
          <span class="summary-value" id="total-days">0日</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">収支</span>
          <span class="summary-value" id="monthly-total">¥0</span>
        </div>
        <button class="btn-chart" id="btn-chart" title="グラフを見る">📊</button>
      </div>

      <!-- グラフモーダル -->
      <div class="modal" id="chart-modal" style="display: none;">
        <div class="modal-content modal-chart">
          <div class="chart-header">
            <h3>収支グラフ</h3>
            <button class="btn-close-chart" id="btn-close-chart">×</button>
          </div>
          <div class="chart-tabs">
            <button class="chart-tab active" data-chart="monthly">月別</button>
            <button class="chart-tab" data-chart="cumulative">累計</button>
            <button class="chart-tab" data-chart="machine">機種別</button>
            <button class="chart-tab" data-chart="hall">店舗別</button>
          </div>
          <div class="chart-period-toggle" id="chart-period-toggle" style="display: none;">
            <button class="period-btn active" data-period="year">年間</button>
            <button class="period-btn" data-period="month">今月</button>
          </div>
          <div class="chart-container">
            <canvas id="balance-chart"></canvas>
          </div>
        </div>
      </div>

      <!-- 表示切替 -->
      <div class="view-toggle">
        <button class="toggle-btn active" id="btn-list-view">履歴</button>
        <button class="toggle-btn" id="btn-calendar-view">カレンダー</button>
      </div>
      </div><!-- /monthly-header -->

      <!-- スクロール可能なコンテンツエリア -->
      <div class="monthly-content" id="monthly-content">
      <!-- カレンダー表示 -->
      <div class="calendar-view" id="calendar-view" style="display: none;">
        <div class="calendar-header">
          <span>日</span><span>月</span><span>火</span><span>水</span><span>木</span><span>金</span><span>土</span>
        </div>
        <div class="calendar-grid" id="calendar-grid">
          <!-- JSで動的に追加 -->
        </div>
      </div>

      <!-- 日別リスト -->
      <div class="daily-list" id="daily-list">
        <!-- JSで動的に追加 -->
        <p class="empty-message" id="empty-message">この月のデータはありません</p>
      </div>
      </div><!-- /monthly-content -->

      <!-- 選択モード用削除バー -->
      <div class="selection-bar" id="selection-bar" style="display: none;">
        <button class="btn btn-secondary" id="btn-cancel-selection">キャンセル</button>
        <span class="selection-count" id="selection-count">0件選択中</span>
        <button class="btn btn-danger" id="btn-delete-selected">削除</button>
      </div>
    </section>

    <!-- ========== 日別入力/詳細画面 ========== -->
    <section id="entry-view" class="section" style="display: none;">
      <div class="entry-header">
        <div class="date-picker-wrapper">
          <span class="date-icon">📅</span>
          <h2 class="entry-date" id="entry-date">2025年11月21日</h2>
          <input type="date" id="date-input" class="date-input-hidden">
        </div>
        <div class="header-buttons">
          <button class="btn btn-secondary btn-small" id="btn-reset">リセット</button>
        </div>
      </div>

      <!-- 画像アップロード -->
      <div class="form-group">
        <label class="form-label">スクリーンショット</label>
        <!-- メインアップロードエリア -->
        <div class="main-drop-zone" id="main-drop-zone">
          <input type="file" class="drop-input" id="main-drop-input" accept="image/*" multiple hidden>
          <span class="camera-icon">📷</span>
          <span class="drop-text">クリックまたはドラッグ＆ドロップで画像を追加</span>
        </div>
        <!-- アップロード済み画像サムネイル -->
        <div class="uploaded-thumbnails" id="uploaded-thumbnails">
          <!-- JSで動的に追加 -->
        </div>
        <div class="ocr-status" id="ocr-status" style="display: none;">
          <div class="ocr-loading-spinner"></div>
          <span class="ocr-loading-text">データを読み取り中...</span>
        </div>
        <button class="btn btn-ocr btn-small" id="btn-ocr" style="display: none;">
          再読み取り
        </button>
        <div class="ocr-result" id="ocr-result" style="display: none;">
          <div class="ocr-data-grid" id="ocr-data-grid">
            <!-- JSで動的に追加 -->
          </div>
        </div>
      </div>

      <!-- ホール名 -->
      <div class="form-group">
        <label class="form-label">ホール名</label>
        <div class="input-with-dropdown">
          <input type="text" id="hall-name" class="input-text" placeholder="例: マルハン新宿店" autocomplete="off">
          <button type="button" class="btn-dropdown" id="btn-hall-dropdown">▼</button>
          <button type="button" class="btn-clear" id="btn-clear-hall" style="display: none;">×</button>
          <div class="custom-dropdown" id="hall-dropdown" style="display: none;">
            <!-- JSで動的に追加 -->
          </div>
        </div>
      </div>

      <!-- 機種名 -->
      <div class="form-group">
        <label class="form-label">機種名</label>
        <div class="input-with-dropdown">
          <input type="text" id="machine-name" class="input-text" placeholder="例: ディスクアップ2" autocomplete="off">
          <button type="button" class="btn-dropdown" id="btn-machine-dropdown">▼</button>
          <button type="button" class="btn-clear" id="btn-clear-machine" style="display: none;">×</button>
          <div class="custom-dropdown" id="machine-dropdown" style="display: none;">
            <!-- JSで動的に追加 -->
          </div>
        </div>
        <div class="machine-stats" id="machine-stats" style="display: none;">
          <!-- 選択した機種の統計 -->
        </div>
      </div>

      <!-- IN/OUT入力 -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">IN（投資枚数）</label>
          <div class="input-with-unit">
            <input type="number" id="input-in" class="input-text" placeholder="0">
            <span class="unit">枚</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">OUT（回収枚数）</label>
          <div class="input-with-unit">
            <input type="number" id="input-out" class="input-text" placeholder="0">
            <span class="unit">枚</span>
          </div>
        </div>
      </div>

      <!-- 稼働時間 -->
      <div class="form-group">
        <label class="form-label">稼働時間</label>
        <div class="time-selector">
          <select id="input-hours" class="input-select">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
          </select>
          <span class="unit">時間</span>
          <select id="input-minutes" class="input-select">
            <option value="0">0</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="30">30</option>
            <option value="40">40</option>
            <option value="50">50</option>
          </select>
          <span class="unit">分</span>
          <span class="hourly-rate" id="hourly-rate"></span>
        </div>
      </div>

      <!-- 差枚表示 -->
      <div class="balance-display">
        <div class="balance-main">
          <span class="balance-label">差枚</span>
          <span class="balance-value" id="balance-value">0枚</span>
        </div>
      </div>

      <!-- メモ -->
      <div class="form-group">
        <label class="form-label">メモ（任意）</label>
        <textarea id="memo" class="input-textarea" placeholder="今日の感想など..."></textarea>
      </div>

      <!-- ブログ生成（一時非表示） -->
      <div class="form-group" style="display: none;">
        <label class="form-label">ブログの文体</label>
        <div class="style-selector" id="style-selector">
          <label class="style-option">
            <input type="radio" name="blog-style" value="polite" checked>
            <span class="style-label">ですます調</span>
            <span class="style-desc">基本</span>
          </label>
          <label class="style-option">
            <input type="radio" name="blog-style" value="casual">
            <span class="style-label">口語ラフ調</span>
            <span class="style-desc">読みやすい</span>
          </label>
          <label class="style-option">
            <input type="radio" name="blog-style" value="live">
            <span class="style-label">実況系</span>
            <span class="style-desc">スロ専向け</span>
          </label>
        </div>
        <button class="btn btn-secondary btn-large" id="btn-generate-blog">
          Gemini AIでブログ生成
        </button>
        <div class="blog-output" id="blog-output" style="display: none;">
          <label class="form-label">生成されたブログ</label>
          <textarea id="blog-content" class="input-textarea blog-textarea" placeholder="ブログ本文がここに生成されます..."></textarea>
          <button class="btn btn-small" id="btn-copy-blog">コピー</button>
        </div>
      </div>

      <!-- 彦一分析（一時非表示） -->
      <div class="form-group" style="display: none;">
        <button class="btn btn-hikoichi btn-large" id="btn-hikoichi">
          彦一の実戦チェック
        </button>
        <div class="hikoichi-output" id="hikoichi-output" style="display: none;">
          <div class="hikoichi-header">
            <span class="hikoichi-icon">📝</span>
            <span class="hikoichi-title">彦一のメモ帳</span>
          </div>
          <div class="hikoichi-content" id="hikoichi-content">
            <!-- JSで動的に追加 -->
          </div>
        </div>
      </div>

      <!-- 保存ボタン -->
      <button class="btn btn-primary btn-large" id="btn-save">
        保存する
      </button>

      <!-- 削除リンク -->
      <div class="delete-entry-link">
        <button type="button" class="btn-link-danger" id="btn-delete">このエントリーを削除</button>
      </div>
    </section>

  </div>

  <script src="script.js?v=14"></script>
</body>
</html>
